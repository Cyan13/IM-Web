{"remainingRequest":"C:\\Users\\shenq\\Downloads\\IM-Web-wdy01 (1)\\IM-Web-wdy01\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\shenq\\Downloads\\IM-Web-wdy01 (1)\\IM-Web-wdy01\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!C:\\Users\\shenq\\Downloads\\IM-Web-wdy01 (1)\\IM-Web-wdy01\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\shenq\\Downloads\\IM-Web-wdy01 (1)\\IM-Web-wdy01\\src\\components\\conversation\\conversation-list.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\shenq\\Downloads\\IM-Web-wdy01 (1)\\IM-Web-wdy01\\src\\components\\conversation\\conversation-list.vue","mtime":1650008938618},{"path":"C:\\Users\\shenq\\Downloads\\IM-Web-wdy01 (1)\\IM-Web-wdy01\\babel.config.js","mtime":1649933650000},{"path":"C:\\Users\\shenq\\Downloads\\IM-Web-wdy01 (1)\\IM-Web-wdy01\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\shenq\\Downloads\\IM-Web-wdy01 (1)\\IM-Web-wdy01\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"C:\\Users\\shenq\\Downloads\\IM-Web-wdy01 (1)\\IM-Web-wdy01\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\shenq\\Downloads\\IM-Web-wdy01 (1)\\IM-Web-wdy01\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es7.object.get-own-property-descriptors\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.object.keys\";\nimport \"core-js/modules/es6.array.find-index\";\nimport _defineProperty from \"C:/Users/shenq/Downloads/IM-Web-wdy01 (1)/IM-Web-wdy01/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport ConversationItem from \"./conversation-item\";\nimport { mapState } from 'vuex';\nimport { getDate, getTime } from \"../../utils/date\";\nexport default {\n  name: 'ConversationList',\n  components: {\n    ConversationItem: ConversationItem\n  },\n  data: function data() {\n    return {\n      showDialog: false,\n      userID: '',\n      isCheckouting: false,\n      // 是否正在切换会话\n      timeout: null,\n      helper_list: null,\n      startTime: '!!!'\n    };\n  },\n  computed: _objectSpread({}, mapState({\n    conversationList: function conversationList(state) {\n      return state.conversation.conversationList;\n    },\n    currentConversation: function currentConversation(state) {\n      return state.conversation.currentConversation;\n    }\n  })),\n  mounted: function mounted() {\n    window.addEventListener('keydown', this.handleKeydown);\n    this.getHelperList();\n  },\n  destroyed: function destroyed() {\n    window.removeEventListener('keydown', this.handleKeydown);\n  },\n  methods: {\n    handleRefresh: function handleRefresh() {\n      this.refreshConversation()();\n    },\n    refreshConversation: function refreshConversation() {\n      var that = this;\n      return function () {\n        if (!that.timeout) {\n          that.timeout = setTimeout(function () {\n            that.timeout = null;\n            that.tim.getConversationList().then(function () {\n              that.$store.commit('showMessage', {\n                message: '刷新成功',\n                type: 'success'\n              });\n            });\n          }, 1000);\n        }\n      };\n    },\n    handleAddButtonClick: function handleAddButtonClick() {\n      this.showDialog = true;\n    },\n    handleConfirm: function handleConfirm() {\n      var _this = this;\n\n      if (this.userID !== '@TIM#SYSTEM') {\n        this.$store.dispatch('checkoutConversation', \"C2C\".concat(this.userID)).then(function () {\n          _this.getTime();\n\n          console.log(_this.startTime);\n\n          _this.$http({\n            url: '/record/saveRecord',\n            method: 'post',\n            crossdomain: true,\n            headers: {\n              'Content-Type': 'application/json'\n            },\n            body: {\n              'consultantID': '32',\n              'helperID': '52',\n              'customerTrueName': '王',\n              'consultantTrueName': '咨询师1',\n              'helperTrueName': '督导1',\n              'date': '2022-04-15 00:00:00.000000',\n              'startTime': '2022-04-13 14:21:10.000000',\n              'endTime': '2022-04-15 14:21:10.000000',\n              'historyURL': 'url'\n            }\n          }).catch(function (err) {\n            console.log(err.data);\n          });\n\n          _this.showDialog = false;\n        }).catch(function () {\n          _this.$store.commit('showMessage', {\n            message: '没有找到该用户',\n            type: 'warning'\n          });\n        });\n      } else {\n        this.$store.commit('showMessage', {\n          message: '没有找到该用户',\n          type: 'warning'\n        });\n      }\n\n      this.userID = '';\n    },\n    getHelperList: function getHelperList() {\n      var _this2 = this;\n\n      this.$http({\n        url: '/admin/getBindWorkerList',\n        method: 'post',\n        crossdomain: true,\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          'username': this.$store1.state.username\n        })\n      }).then(function (res) {\n        // console.log(res)\n        console.log('helperlist');\n        _this2.helper_list = res.data.data;\n        console.log(_this2.helper_list);\n      }).catch(function (err) {\n        console.log(err.data);\n      });\n    },\n    handleKeydown: function handleKeydown(event) {\n      var _this3 = this;\n\n      if (event.keyCode !== 38 && event.keyCode !== 40 || this.isCheckouting) {\n        return;\n      }\n\n      var currentIndex = this.conversationList.findIndex(function (item) {\n        return item.conversationID === _this3.currentConversation.conversationID;\n      });\n\n      if (event.keyCode === 38 && currentIndex - 1 >= 0) {\n        this.checkoutPrev(currentIndex);\n      }\n\n      if (event.keyCode === 40 && currentIndex + 1 < this.conversationList.length) {\n        this.checkoutNext(currentIndex);\n      }\n    },\n    checkoutPrev: function checkoutPrev(currentIndex) {\n      var _this4 = this;\n\n      this.isCheckouting = true;\n      this.$store.dispatch('checkoutConversation', this.conversationList[currentIndex - 1].conversationID).then(function () {\n        _this4.isCheckouting = false;\n      }).catch(function () {\n        _this4.isCheckouting = false;\n      });\n    },\n    checkoutNext: function checkoutNext(currentIndex) {\n      var _this5 = this;\n\n      this.isCheckouting = true;\n      this.$store.dispatch('checkoutConversation', this.conversationList[currentIndex + 1].conversationID).then(function () {\n        _this5.isCheckouting = false;\n      }).catch(function () {\n        _this5.isCheckouting = false;\n      });\n    },\n    getTime: function getTime() {\n      this.startTime = new Date();\n    }\n  }\n};",{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAoCA;AACA;AACA;AACA;AACAA,0BADA;AAEAC;AAAAC;AAAA,GAFA;AAGAC,MAHA,kBAGA;AACA;AACAC,uBADA;AAEAC,gBAFA;AAGAC,0BAHA;AAGA;AACAC,mBAJA;AAKAC,uBALA;AAMAC;AANA;AAQA,GAZA;AAaAC,8BACAC;AACAC;AAAA;AAAA,KADA;AAEAC;AAAA;AAAA;AAFA,IADA,CAbA;AAmBAC,SAnBA,qBAmBA;AACAC;AACA;AACA,GAtBA;AAuBAC,WAvBA,uBAuBA;AACAD;AACA,GAzBA;AA0BAE;AACAC,iBADA,2BACA;AACA;AACA,KAHA;AAIAC,uBAJA,iCAIA;AACA;AACA;AACA;AACAC;AACAA;AACAA;AACAA;AACAC,+BADA;AAEAC;AAFA;AAIA,aALA;AAMA,WARA,EAQA,IARA;AASA;AACA,OAZA;AAaA,KAnBA;AAoBAC,wBApBA,kCAoBA;AACA;AACA,KAtBA;AAuBAC;AAAA;;AACA;AACA,oBACAC,QADA,CACA,sBADA,eACA,WADA,GAEAC,IAFA,CAEA;AACA;;AACAC;;AACA;AACAC,qCADA;AAEAC,0BAFA;AAGAC,6BAHA;AAIAC;AAAA;AAAA,aAJA;AAKAC;AACA,kCADA;AAEA,8BAFA;AAGA,qCAHA;AAIA,0CAJA;AAKA,qCALA;AAMA,kDANA;AAOA,uDAPA;AAQA,qDARA;AASA;AATA;AALA,aAgBAC,KAhBA,CAgBA;AACAN;AACA,WAlBA;;AAoBA;AACA,SA1BA,EA0BAM,KA1BA,CA0BA;AACA;AACAZ,8BADA;AAEAC;AAFA;AAIA,SA/BA;AAgCA,OAjCA,MAiCA;AACA;AACAD,4BADA;AAEAC;AAFA;AAIA;;AACA;AACA,KAhEA;AAiEAY,iBAjEA,2BAiEA;AAAA;;AACA;AACAN,uCADA;AAEAC,sBAFA;AAGAC,yBAHA;AAIAC;AAAA;AAAA,SAJA;AAKAC;AACA;AADA;AALA,SAQAN,IARA,CAQA;AACA;AACAC;AACA;AACAA;AACA,OAbA,EAaAM,KAbA,CAaA;AACAN;AACA,OAfA;AAgBA,KAlFA;AAmFAQ,iBAnFA,yBAmFAC,KAnFA,EAmFA;AAAA;;AACA;AACA;AACA;;AACA,yDACA;AAAA;AAAA,OADA;;AAGA;AACA;AACA;;AACA,UACAA,wBACAC,+CAFA,EAGA;AACA;AACA;AACA,KAnGA;AAoGAC,gBApGA,wBAoGAD,YApGA,EAoGA;AAAA;;AACA;AACA,kBACAZ,QADA,CAEA,sBAFA,EAGA,sDAHA,EAKAC,IALA,CAKA;AACA;AACA,OAPA,EAQAO,KARA,CAQA;AACA;AACA,OAVA;AAWA,KAjHA;AAkHAM,gBAlHA,wBAkHAF,YAlHA,EAkHA;AAAA;;AACA;AACA,kBACAZ,QADA,CAEA,sBAFA,EAGA,sDAHA,EAKAC,IALA,CAKA;AACA;AACA,OAPA,EAQAO,KARA,CAQA;AACA;AACA,OAVA;AAWA,KA/HA;AAgIAO,WAhIA,qBAgIA;AACA;AACA;AAlIA;AA1BA","names":["name","components","ConversationItem","data","showDialog","userID","isCheckouting","timeout","helper_list","startTime","computed","mapState","conversationList","currentConversation","mounted","window","destroyed","methods","handleRefresh","refreshConversation","that","message","type","handleAddButtonClick","handleConfirm","dispatch","then","console","url","method","crossdomain","headers","body","catch","getHelperList","handleKeydown","event","currentIndex","checkoutPrev","checkoutNext","getTime"],"sourceRoot":"src/components/conversation","sources":["conversation-list.vue"],"sourcesContent":["<template>\n  <div class=\"list-container\">\n    <div class=\"header-bar\">\n      <button title=\"刷新列表\" @click=\"handleRefresh\">\n        <i class=\"tim-icon-refresh\"></i>\n      </button>\n      <button title=\"求助督导\" @click=\"handleAddButtonClick\">\n        <i class=\"el-icon-notebook-1\"></i>\n      </button>\n    </div>\n    <div class=\"scroll-container\">\n      <conversation-item\n          :conversation=\"item\"\n          v-for=\"item in conversationList\"\n          :key=\"item.conversationID\"\n      />\n    </div>\n    <el-dialog title=\"选择求助的督导\" :visible.sync=\"showDialog\" width=\"30%\">\n      <el-select v-model=\"userID\" placeholder=\"请选择求助督导\">\n        <el-option\n            v-for=\"item in helper_list\"\n            :key=\"item.id\"\n            :label=\"item.trueName\"\n            :value=\"item.username\">\n        </el-option>\n      </el-select>\n      <!--      <el-input placeholder=\"请输入用户ID\" v-model=\"userID\" @keydown.enter.native=\"handleConfirm\"/>-->\n      <span slot=\"footer\" class=\"dialog-footer\">\n        <el-button @click=\"showDialog = false\">取 消</el-button>\n        <el-button type=\"primary\" @click=\"handleConfirm\">确 定</el-button>\n      </span>\n    </el-dialog>\n  </div>\n</template>\n\n<script>\nimport ConversationItem from './conversation-item'\nimport { mapState } from 'vuex'\nimport { getDate, getTime } from '../../utils/date'\nexport default {\n  name: 'ConversationList',\n  components: { ConversationItem },\n  data() {\n    return {\n      showDialog: false,\n      userID: '',\n      isCheckouting: false, // 是否正在切换会话\n      timeout: null,\n      helper_list: null,\n      startTime: '!!!'\n    }\n  },\n  computed: {\n    ...mapState({\n      conversationList: state => state.conversation.conversationList,\n      currentConversation: state => state.conversation.currentConversation\n    })\n  },\n  mounted() {\n    window.addEventListener('keydown', this.handleKeydown)\n    this.getHelperList()\n  },\n  destroyed() {\n    window.removeEventListener('keydown', this.handleKeydown)\n  },\n  methods: {\n    handleRefresh() {\n      this.refreshConversation()()\n    },\n    refreshConversation() {\n      let that = this\n      return function () {\n        if (!that.timeout) {\n          that.timeout = setTimeout(() =>{\n            that.timeout = null\n            that.tim.getConversationList().then(() => {\n              that.$store.commit('showMessage', {\n                message: '刷新成功',\n                type: 'success'\n              })\n            })\n          }, 1000)\n        }\n      }\n    },\n    handleAddButtonClick() {\n      this.showDialog = true\n    },\n    handleConfirm: function () {\n      if (this.userID !== '@TIM#SYSTEM') {\n        this.$store\n            .dispatch('checkoutConversation', `C2C${this.userID}`)\n            .then(() => {\n              this.getTime()\n              console.log(this.startTime)\n              this.$http({\n                url: '/record/saveRecord',\n                method: 'post',\n                crossdomain: true,\n                headers: {'Content-Type': 'application/json'},\n                body: {\n                  'consultantID': '32',\n                  'helperID': '52',\n                  'customerTrueName': '王',\n                  'consultantTrueName': '咨询师1',\n                  'helperTrueName': '督导1',\n                  'date': '2022-04-15 00:00:00.000000',\n                  'startTime': '2022-04-13 14:21:10.000000',\n                  'endTime': '2022-04-15 14:21:10.000000',\n                  'historyURL': 'url'\n                }\n              }).catch(err => {\n                console.log(err.data)\n              })\n\n              this.showDialog = false\n            }).catch(() => {\n          this.$store.commit('showMessage', {\n            message: '没有找到该用户',\n            type: 'warning'\n          })\n        })\n      } else {\n        this.$store.commit('showMessage', {\n          message: '没有找到该用户',\n          type: 'warning'\n        })\n      }\n      this.userID = ''\n    },\n    getHelperList() {\n      this.$http({\n        url: '/admin/getBindWorkerList',\n        method: 'post',\n        crossdomain: true,\n        headers: {'Content-Type': 'application/json'},\n        body:JSON.stringify({\n          'username': this.$store1.state.username\n        })\n      }).then(res => {\n        // console.log(res)\n        console.log('helperlist')\n        this.helper_list=res.data.data\n        console.log(this.helper_list)\n      }).catch(err => {\n        console.log(err.data)\n      })\n    },\n    handleKeydown(event) {\n      if (event.keyCode !== 38 && event.keyCode !== 40 || this.isCheckouting) {\n        return\n      }\n      const currentIndex = this.conversationList.findIndex(\n          item => item.conversationID === this.currentConversation.conversationID\n      )\n      if (event.keyCode === 38 && currentIndex - 1 >= 0) {\n        this.checkoutPrev(currentIndex)\n      }\n      if (\n          event.keyCode === 40 &&\n          currentIndex + 1 < this.conversationList.length\n      ) {\n        this.checkoutNext(currentIndex)\n      }\n    },\n    checkoutPrev(currentIndex) {\n      this.isCheckouting = true\n      this.$store\n          .dispatch(\n              'checkoutConversation',\n              this.conversationList[currentIndex - 1].conversationID\n          )\n          .then(() => {\n            this.isCheckouting = false\n          })\n          .catch(() => {\n            this.isCheckouting = false\n          })\n    },\n    checkoutNext(currentIndex) {\n      this.isCheckouting = true\n      this.$store\n          .dispatch(\n              'checkoutConversation',\n              this.conversationList[currentIndex + 1].conversationID\n          )\n          .then(() => {\n            this.isCheckouting = false\n          })\n          .catch(() => {\n            this.isCheckouting = false\n          })\n    },\n    getTime() {\n      this.startTime = new Date()\n    }\n  }\n}\n</script>\n\n<style lang=\"stylus\" scoped>\n.list-container\n  height 100%\n  width 100%\n  display flex\n  flex-direction column // -reverse\n  .header-bar\n    flex-shrink 0\n    height 50px\n    border-bottom 1px solid $background-deep-dark\n    padding 10px 10px 10px 20px\n    button\n      float right\n      display: inline-block;\n      cursor: pointer;\n      background $background-deep-dark\n      border: none\n      color: $font-dark;\n      box-sizing: border-box;\n      transition: .3s;\n      -moz-user-select: none;\n      -webkit-user-select: none;\n      -ms-user-select: none;\n      margin: 0 10px 0 0\n      padding 0\n      width 30px\n      height 30px\n      line-height 34px\n      font-size: 24px;\n      text-align: center;\n      white-space: nowrap;\n      border-radius: 50%\n      outline 0\n      &:hover\n        // background $light-primary\n        // color $white\n        //transform: rotate(360deg);\n        color $light-primary\n  .scroll-container\n    overflow-y scroll\n    flex 1\n.bottom-circle-btn {\n  position: absolute;\n  bottom: 20px;\n  right: 20px;\n}\n\n.refresh {\n  bottom: 70px;\n}\n</style>\n"]}]}